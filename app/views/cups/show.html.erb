<%= render(BannerComponent.new) do %>
  <% if Time.current > @cup.deadline %>
    <%= raw t(".deadline_passed", deadline: I18n.l(@cup.deadline, format: :long)) %>
  <% elsif @cup.not_yet_registerable? %>
    <%= raw t(".registrations_opening_soon", deadline: I18n.l(@cup.deadline, format: :long)) %>
  <% elsif @cup.registerable? %>
    <%= raw t(".deadline", deadline: I18n.l(@cup.deadline, format: :long)) %>
  <% end %>
<% end %>
<div class="max-w-7xl mx-auto py-3 px-3 sm:px-6 lg:px-8">
  <%= render(HeroComponent.new(cup: @cup, current_user: current_user)) %>
  <div class="lg:grid lg:grid-cols-3 lg:gap-12">
    <div class="mt-6 prose prose-red-900 prose-lg text-gray-900 lg:col-span-2" id="program">
      <% if @headlines.any? %>
        <div class="mt-4">
          <%= render "headline", headline: @headlines.first %>
        </div>
      <% end %>
      <% if @cup.registerable? %>
        <h2 class="mt-10">
          <%= t '.program.title' %>
        </h2>
        <div class="lg:grid lg:grid-cols-2 lg:gap-8"></div>
          <% @grouped_events.each do |date, events| %>
            <div class="lg:col-1">
              <h3 class="mt-0">
                <%= l date, format: :short %>
              </h3>
              <table class="table">
                <tbody>
                  <% for event in events %>
                    <tr>
                      <th  class="whitespace-nowrap align-text-top">
                        <%= event.start_on.to_formatted_s(:time_only) %>
                      </th>
                      <td>
                        <%= event.name %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% end %>
          <div id="categories" class="prose prose-red-900 prose-lg text-gray-900 lg:col-span-2">
            <h2 class="mt-10">
              <%= t '.categories.title' %>
            </h2>
            <p>
              <%= t(".shinpans.info") %>
            </p>
            <p>
              <%= t(".categories.description") %>
            </p>
            <table class="table">
              <tbody>
                <% @cup.individual_categories.order(:name).each do |c| %>
                  <tr>
                    <th class="whitespace-nowrap">
                      <%= c.name %>
                    </th>
                    <td>
                      <% if c.description.present? %>
                        <%= c.description %>
                      <% elsif c.min_age %>
                        <%= c.max_age ? t("categories.from") : t("categories.from") %>
                        <%= c.min_age %>
                        <%= t("categories.yo") %>
                      <% elsif c.max_age %>
                        <%= t("categories.to") %>
                        <%= c.max_age %>
                        <%= t("categories.yo") %>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
                <% @cup.team_categories.each do |c| %>
                  <tr>
                    <th>
                      <%= c.name.capitalize %>
                    </th>
                    <td>
                      <%= "#{c.description}" %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
          <div id="fees" class="prose prose-red-900 prose-lg text-gray-900 lg:col-span-2">
            <h2 class="mt-10">
              <%= t '.fees.title' %>
            </h2>
            <p>
              <%= t(".fees.description") %>
            </p>
            <table class="table">
              <tbody>
                <tr>
                  <th class="whitespace-nowrap align-text-top">
                    <%= raw t(".fees.adults.title", year: @cup.year - 18) %>
                  </th>
                  <td>
                    <%= raw t '.fees.adults.fee', adult_fees_chf: @cup.adult_fees_chf, adult_fees_eur: @cup.adult_fees_eur %>
                  </td>
                </tr>
                <tr>
                  <th>
                    <%= raw t(".fees.juniors.title", year: @cup.year - 17) %>
                  </th>
                  <td>
                    <%= raw t '.fees.juniors.fee', junior_fees_chf: @cup.junior_fees_chf, junior_fees_eur: @cup.junior_fees_eur %>
                  </td>
                </tr>
                <% @cup.products.each do |product| %>
                  <tr>
                    <th class="lg:whitespace-nowrap">
                      <%= product.name %>
                      <% if product.description.present? %>
                          <em class="text-gray-500 ">(<%= product.description %>)</em>
                      <% end %>
                      <% if !product.still_available? %>
                        <span class="text-brand italic">(<%= t(".products.not_available") %>)</span>
                      <% end %>
                    </th>
                    <td>
                      <% if product.fee_chf == 0 %>
                        <%= t '.fees.variable' %>
                      <% else %>
                        <%= "#{product.fee_chf} CHF / #{product.fee_eu} â‚¬" %>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      <% end %>
      <%= md_to_html(@cup.description) %>
    </div>
    <% if @cup.registerable? %>
      <div class="mt-10">
        <%= render "current_user_resume" %>
      </div>
    <% end %>
  </div>
</div>
